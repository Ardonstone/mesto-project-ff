/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{F:()=>Z});var e={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"b39de8ea-6873-4606-b10b-695abf431d72","Content-Type":"application/json"}},n=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={method:t,headers:e.headers};return r&&Object.keys(r).length>0&&(o.body=JSON.stringify(r)),fetch("".concat(e.baseUrl).concat(n),o).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))};function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=i.querySelector(".card__image"),u=i.querySelector(".card__like-block_button"),a=i.querySelector(".card__like-block_counter"),l=i.querySelector(".card__delete-button"),s=t.name,p=t.link;return c.src=p,c.alt=s,i.querySelector(".card__title").textContent=s,t.likes.find((function(e){t.owner._id}))&&u.classList.toggle("card__like-block_button_is-active"),e===t.owner._id&&o(l,t._id),a.textContent=t.likes.length,c.addEventListener("click",(function(){n(s,p)})),u.addEventListener("click",(function(){r(u,a,t._id)})),i}function o(t,e,r){(t.classList.contains("card__like-block_button_is-active")?function(t){return n("DELETE","/cards/likes/".concat(t))}(r):function(t){return n("PUT","/cards/likes/".concat(t))}(r)).then((function(n){!function(t,e,n){e.textContent=n.length,t.classList.contains("card__like-block_button_is-active")?t.classList.remove("card__like-block_button_is-active"):t.classList.add("card__like-block_button_is-active")}(t,e,n.likes)})).catch((function(t){return console.log(t)}))}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",u(evt))}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u(evt))}function u(t){"Escape"===t.key&&document.querySelector(".popup_is-opened")&&c(document.querySelector(".popup_is-opened"))}function a(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass,i=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(r),i.classList.remove(o),i.textContent=""}function l(t){var e=t.inputList,n=t.submitButtonElement,r=t.inactiveButtonClass;!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.disable=!1,n.classList.remove(r)):(n.disable=!0,n.classList.add(r))}function s(t,e){var n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,i=e.inputErrorClass,c=e.errorClass,u=Array.from(t.querySelectorAll(n)),s=t.querySelector(r);u.forEach((function(e){a({formElement:t,inputElement:e,inputErrorClass:i,errorClass:c})})),l({inputList:u,submitButtonElement:s,inactiveButtonClass:o})}function p(t,e){t.textContent=e?"Сохранение...":"Сохранить"}function f(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var a=r&&r.prototype instanceof u?r:u,l=Object.create(a.prototype);return d(l,"_invoke",function(n,r,o){var i,u,a,l=0,s=o||[],p=!1,f={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,u=0,a=t,f.n=n,c}};function d(n,r){for(u=n,a=r,e=0;!p&&l&&!o&&e<s.length;e++){var o,i=s[e],d=f.p,m=i[2];n>3?(o=m===r)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(u=0,f.v=r,f.n=i[1]):d<m&&(o=n<3||i[0]>r||r>m)&&(i[4]=n,i[5]=r,f.n=m,u=0))}if(o||n>1)return c;throw p=!0,r}return function(o,s,m){if(l>1)throw TypeError("Generator is already running");for(p&&1===s&&d(s,m),u=s,a=m;(e=u<2?t:a)||!p;){i||(u?u<3?(u>1&&(f.n=-1),d(u,a)):f.n=a:f.v=a);try{if(l=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(p=f.n<0)?a:n.call(r,f))!==c)break}catch(e){i=t,u=1,a=e}finally{l=1}}return{value:e,done:p}}}(n,o,i),!0),l}var c={};function u(){}function a(){}function l(){}e=Object.getPrototypeOf;var s=[][r]?e(e([][r]())):(d(e={},r,(function(){return this})),e),p=l.prototype=u.prototype=Object.create(s);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,d(t,o,"GeneratorFunction")),t.prototype=Object.create(p),t}return a.prototype=l,d(p,"constructor",l),d(l,"constructor",a),a.displayName="GeneratorFunction",d(l,o,"GeneratorFunction"),d(p),d(p,o,"Generator"),d(p,r,(function(){return this})),d(p,"toString",(function(){return"[object Generator]"})),(f=function(){return{w:i,m}})()}function d(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}d=function(t,e,n,r){if(e)o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n;else{function i(e,n){d(t,e,(function(t){return this._invoke(e,n,t)}))}i("next",0),i("throw",1),i("return",2)}},d(t,e,n,r)}function m(t,e,n,r,o,i,c){try{var u=t[i](c),a=u.value}catch(t){return void n(t)}u.done?e(a):Promise.resolve(a).then(r,o)}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var y,_,b,E,h,S,C,g,k,L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},q=document.querySelector(".places__list"),w=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_edit-avatar"),O=document.querySelector(".popup_type_new-card"),B=document.querySelector(".popup_type_image"),T=document.querySelector(".popup_type_confirm"),x=document.querySelectorAll(".popup"),A=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption"),G=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),M=document.querySelector(".profile__info"),F=M.querySelector(".profile__title"),I=M.querySelector(".profile__description"),U=document.querySelector(".profile__image"),N=document.forms["edit-profile"],H=N.name,V=N.description,z=N.querySelector(".button"),J=document.forms["edit-avatar"],$=J.querySelector(".popup__button"),K=J.avatar,Q=document.forms["new-place"],R=Q["place-name"],W=Q.link,X=Q.querySelector(".popup__button"),Y=document.forms["delete-card"];function Z(t){!0===t?i(T):c(T)}function tt(t,e,n){F.textContent=t,I.textContent=e,U.style.backgroundImage="url(".concat(n,")")}function et(t,e){A.src=e,A.alt=t,P.textContent=t,i(B)}function nt(t,e){t.style.display="block",t.addEventListener("click",(function(){Z(!0),_=e,y=t}))}U.addEventListener("click",(function(){i(j)})),D.addEventListener("click",(function(){i(O)})),G.addEventListener("click",(function(){V.value=I.textContent,H.value=F.textContent,i(w)})),J.addEventListener("submit",(function(t){!function(t){var e;t.preventDefault(),p($,!0),(e={avatar:K.value},n("PATCH","/users/me/avatar",e)).then((function(t){tt(t.name,t.about,t.avatar),c(j),J.reset(),s(J,L)})).catch((function(t){console.log(t)})).finally((function(){p($,!1)}))}(t)})),N.addEventListener("submit",(function(t){!function(t){var e,r,o;t.preventDefault(),p(z,!0),(e={name:H.value,about:V.value},r=e.name,o=e.about,n("PATCH","/users/me",{name:r,about:o})).then((function(t){tt(t.name,t.about,t.avatar),c(w),N.reset(),s(N,L)})).catch((function(t){console.log(t)})).finally((function(){p(z,!1)}))}(t)})),Q.addEventListener("submit",(function(t){!function(t){var e,i,u;t.preventDefault(),p(X,!0),(e={name:R.value,link:W.value},i=e.name,u=e.link,n("POST","/cards",{name:i,link:u})).then((function(t){q.prepend(r(t,t.owner._id,et,o,nt)),c(O),Q.reset(),s(Q,L)})).catch((function(t){console.log(t)})).finally((function(){p(X,!1)}))}(t)})),Y.addEventListener("submit",(function(t){!function(t,e,r){var o;t.preventDefault(),(o=r,n("DELETE","/cards/".concat(o))).then((function(){e.closest(".places__item").remove(),Z(!1)})).catch((function(t){return console.log(t)}))}(t,y,_)})),x.forEach((function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){c(t)})),t.addEventListener("mousedown",(function(e){!function(t,e){t.target===t.currentTarget&&c(e)}(e,t)}))})),E=(b=L).formSelector,h=b.inputSelector,S=b.submitButtonSelector,C=b.inactiveButtonClass,g=b.inputErrorClass,k=b.errorClass,Array.from(document.querySelectorAll(E)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=t.formElement,n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,i=t.inputErrorClass,c=t.errorClass,u=Array.from(e.querySelectorAll(n)),s=e.querySelector(r);l({inputList:u,submitButtonElement:s,inactiveButtonClass:o}),u.forEach((function(t){t.addEventListener("input",(function(){!function(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a({formElement:e,inputElement:n,inputErrorClass:r,errorClass:o}):function(t){var e=t.inputElement,n=t.inputErrorClass,r=t.errorClass,o=t.errorMessage,i=t.formElement.querySelector(".".concat(e.id,"-error"));i.textContent=o,e.classList.add(n),i.classList.add(r)}({formElement:e,inputElement:n,inputErrorClass:r,errorClass:o,errorMessage:n.validationMessage})}({formElement:e,inputElement:t,inputErrorClass:i,errorClass:c}),l({inputList:u,submitButtonElement:s,inactiveButtonClass:o})}))}))}({formElement:t,inputSelector:h,submitButtonSelector:S,inactiveButtonClass:C,inputErrorClass:g,errorClass:k})})),Promise.all([n("GET","/users/me"),n("GET","/cards")]).then((function(t){var e,n,i=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,c,u=[],a=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=i[0],u=i[1];tt(c.name,c.about,c.avatar),u.forEach(function(){var t,e=(t=f().m((function t(e){return f().w((function(t){for(;;)switch(t.n){case 0:q.append(r(e,c._id,et,o,nt));case 1:return t.a(2)}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){m(i,r,o,c,u,"next",t)}function u(t){m(i,r,o,c,u,"throw",t)}c(void 0)}))});return function(t){return e.apply(this,arguments)}}())})).catch((function(t){console.log(t)}))})();